<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TinyMCE with Letterhead</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/node_modules/tinymce/tinymce.min.js"></script>
    <script src="/node_modules/air-datepicker/air-datepicker.js"></script>
    <script src="/node_modules/air-datepicker/locale/en.js"></script>
    <link rel="stylesheet" href="/node_modules/air-datepicker/air-datepicker.css">
  </head>
  <body class="bg-gray-100 p-6">
    
    <!-- Header -->
    <div class="flex items-center rounded text-[#2C3E50] mb-4">
      <span class="text-[#F6AA04] font-bold text-xl mr-2">|</span>
      <h2 class="font-bold text-xl">Detail Working Order</h2>
    </div>

    <div class="flex justify-start">
        <button
          onclick="generateFullDoc()"
          class="mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mx-2"
        >
          Preview Full Document
        </button>
        <button
          class="mb-4 px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700"
        >
          Save Changes
        </button>
      </div>
      

    <!-- Wrapper for all content -->
    <div class="mb-4 bg-white border shadow mx-auto" style="width: 21cm; min-height: 29.7cm; padding: 2cm; font-size: 10pt;">

      <!-- Letterhead -->
      <div id="letterhead">
        <div class="flex justify-between items-center">
          <img src="https://placehold.co/100x50" alt="Logo 1" />
          <div class="text-center text-sm">
            <p class="font-bold">PT Niterra Mobility Indonesia</p>
            <p>Jl. Raya Jakarta-Bogor Km. 26,6 Ciracas</p>
            <p>Jakarta Timur, Indonesia</p>
          </div>
          <img src="https://placehold.co/80x50" alt="Logo 2" />
        </div>
        <hr class="mt-2 border-t border-black" />
        <hr class="mt-[1px] border-t border-black" />
        <p class="text-lg font-bold text-center underline mt-4">
          WORKING ORDER CONFIRMATION
        </p>
        <p class="text-sm font-bold text-center underline">##NUMBER##</p>
      </div>

      <!-- Letter Body -->
        <table id="letterbody" class="table-auto w-full mt-4">
          <tbody>
            <tr>
              <td class="align-top w-[170px]">To</td>
              <td><span id="vendor" name="vendor">##VENDOR##</span></td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Attn</td>
              <td>
                <input
                  type="text"
                  name="attn"
                  id="attn"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Ref Quotation No & Date</td>
              <td>
                <input
                  type="text"
                  name="ref"
                  id="ref"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Project</td>
              <td>
                <input
                  type="text"
                  name="project"
                  id="project"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <textarea id="project-field" class="w-full mt-2">
                        <table class="table-auto border border-gray-400 border-collapse">
                          <thead>
                            <tr>
                              <th class="border border-gray-400 px-4 py-2">Song</th>
                              <th class="border border-gray-400 px-4 py-2">Artist</th>
                              <th class="border border-gray-400 px-4 py-2">Year</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td class="border border-gray-400 px-4 py-2">The Sliding Mr. Bones (Next Stop, Pottersville)</td>
                              <td class="border border-gray-400 px-4 py-2">Malcolm Lockyer</td>
                              <td class="border border-gray-400 px-4 py-2">1961</td>
                            </tr>
                            <tr>
                              <td class="border border-gray-400 px-4 py-2">Witchy Woman</td>
                              <td class="border border-gray-400 px-4 py-2">The Eagles</td>
                              <td class="border border-gray-400 px-4 py-2">1972</td>
                            </tr>
                            <tr>
                              <td class="border border-gray-400 px-4 py-2">Shining Star</td>
                              <td class="border border-gray-400 px-4 py-2">Earth, Wind, and Fire</td>
                              <td class="border border-gray-400 px-4 py-2">1975</td>
                            </tr>
                          </tbody>
                        </table>
                </textarea>
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Date</td>
              <td><span id="date" name="date">##DATENOW##</span></td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Total</td>
              <td>
                <input
                  type="text"
                  name="total"
                  id="total"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Payment Term</td>
              <td>
                <input
                  type="text"
                  name="payment"
                  id="payment"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Start Date</td>
              <td>
                <input
                  type="text"
                  name="startDate"
                  id="startDate"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">End Date</td>
              <td>
                <input
                  type="text"
                  name="endDate"
                  id="endDate"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">BUDGET NO</td>
              <td>
                <select
                  name="budgetNo"
                  id="budgetNo"
                  class="border rounded w-full px-2"
                >
                  <option value="">Select Budget No</option>
                  <option value="1">Budget 1</option>
                  <option value="2">Budget 2</option>
                  <option value="3">Budget 3</option>
                </select>
              </td>
            </tr>
            <tr>
              <td class="align-top w-[170px]">Remark</td>
              <td>
                <input
                  type="text"
                  name="remark"
                  id="remark"
                  class="border rounded w-full px-2"
                />
              </td>
            </tr>
          </tbody>
        </table>
        <p>Please attach working order confirmation together with Invoice.</p>
      

      <!-- Approval Section -->
      <div id="approval">
        <div class="flex justify-end gap-12 mb-6">
          <div class="flex flex-col items-center gap-1">
            <div class="text-[12px]">Approved By:</div>
            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 72 72" fill="none">
<g id="Stamp">
<path d="M36 1C55.33 1 71 16.67 71 36C71 55.33 55.33 71 36 71C16.67 71 1 55.33 1 36C1 16.67 16.67 1 36 1ZM4.86719 49.6807C10.1323 61.6452 22.0895 70 36 70C49.9105 70 61.8677 61.6452 67.1328 49.6807H4.86719ZM69.5107 30.9648H2.48926V30.2334C2.169 32.1078 2 34.0343 2 36C2 40.6265 2.926 45.0363 4.59961 49.0566V48.6807H67.5547C69.1309 44.762 70 40.4826 70 36C70 34.0343 69.831 32.1078 69.5107 30.2334V30.9648ZM36 2C19.282 2 5.38226 14.0662 2.53418 29.9648H69.4658C66.6177 14.0662 52.718 2 36 2Z" fill="#FF0000"/>
<path d="M4.86719 49.6807V49.1807H4.10088L4.40954 49.8821L4.86719 49.6807ZM67.1328 49.6807L67.5905 49.8821L67.8991 49.1807H67.1328V49.6807ZM69.5107 30.9648V31.4648H70.0107V30.9648H69.5107ZM2.48926 30.9648H1.98926V31.4648H2.48926V30.9648ZM2.48926 30.2334H2.98926L1.9964 30.1492L2.48926 30.2334ZM4.59961 49.0566L4.13801 49.2488L5.09961 49.0566H4.59961ZM4.59961 48.6807V48.1807H4.09961V48.6807H4.59961ZM67.5547 48.6807V49.1807H67.8925L68.0186 48.8673L67.5547 48.6807ZM69.5107 30.2334L70.0036 30.1492L69.0107 30.2334H69.5107ZM2.53418 29.9648L2.04201 29.8767L1.93665 30.4648H2.53418V29.9648ZM69.4658 29.9648V30.4648H70.0633L69.958 29.8767L69.4658 29.9648ZM36 1V1.5C55.0538 1.5 70.5 16.9462 70.5 36H71H71.5C71.5 16.3939 55.6061 0.5 36 0.5V1ZM71 36H70.5C70.5 55.0538 55.0538 70.5 36 70.5V71V71.5C55.6061 71.5 71.5 55.6061 71.5 36H71ZM36 71V70.5C16.9462 70.5 1.5 55.0538 1.5 36H1H0.5C0.5 55.6061 16.3939 71.5 36 71.5V71ZM1 36H1.5C1.5 16.9462 16.9462 1.5 36 1.5V1V0.5C16.3939 0.5 0.5 16.3939 0.5 36H1ZM4.86719 49.6807L4.40954 49.8821C9.75163 62.0214 21.8841 70.5 36 70.5V70V69.5C22.2949 69.5 10.513 61.269 5.32483 49.4793L4.86719 49.6807ZM36 70V70.5C50.1159 70.5 62.2484 62.0214 67.5905 49.8821L67.1328 49.6807L66.6752 49.4793C61.487 61.269 49.7051 69.5 36 69.5V70ZM67.1328 49.6807V49.1807H4.86719V49.6807V50.1807H67.1328V49.6807ZM69.5107 30.9648V30.4648H2.48926V30.9648V31.4648H69.5107V30.9648ZM2.48926 30.9648H2.98926V30.2334H2.48926H1.98926V30.9648H2.48926ZM2.48926 30.2334L1.9964 30.1492C1.67147 32.051 1.5 34.0055 1.5 36H2H2.5C2.5 34.063 2.66653 32.1647 2.98212 30.3176L2.48926 30.2334ZM2 36H1.5C1.5 40.6937 2.43956 45.1688 4.13801 49.2488L4.59961 49.0566L5.06121 48.8645C3.41244 44.9038 2.5 40.5592 2.5 36H2ZM4.59961 49.0566H5.09961V48.6807H4.59961H4.09961V49.0566H4.59961ZM4.59961 48.6807V49.1807H67.5547V48.6807V48.1807H4.59961V48.6807ZM67.5547 48.6807L68.0186 48.8673C69.6182 44.8904 70.5 40.5478 70.5 36H70H69.5C69.5 40.4175 68.6436 44.6336 67.0908 48.4941L67.5547 48.6807ZM70 36H70.5C70.5 34.0055 70.3285 32.051 70.0036 30.1492L69.5107 30.2334L69.0179 30.3176C69.3335 32.1647 69.5 34.063 69.5 36H70ZM69.5107 30.2334H69.0107V30.9648H69.5107H70.0107V30.2334H69.5107ZM36 2V1.5C19.0356 1.5 4.93204 13.7439 2.04201 29.8767L2.53418 29.9648L3.02635 30.053C5.83249 14.3885 19.5283 2.5 36 2.5V2ZM2.53418 29.9648V30.4648H69.4658V29.9648V29.4648H2.53418V29.9648ZM69.4658 29.9648L69.958 29.8767C67.068 13.7439 52.9644 1.5 36 1.5V2V2.5C52.4717 2.5 66.1675 14.3885 68.9737 30.053L69.4658 29.9648Z" fill="#FF0000"/>
</g>
</svg> -->
            <div class="flex w-[70px] h-[70px] py-[15px] flex-col items-center gap-[9px]" style="background-image: url('/Stamp.svg'); background-size: cover; background-repeat: no-repeat; background-position: center;">
              <p class="text-[10px] leading-[10px] font-bold text-red-500 font-inter text-center">DOLLY
            </p>
            <p class="text-[10px] leading-[10px] font-normal text-red-500 font-inter text-center">
            05.05.2025
            </p>
            </div>
            <div class="text-[12px] font-bold italic">(DOLLY INDRA)</div>
          </div>
          <div class="flex flex-col items-center gap-1">
            <div class="text-[12px]">Prepared By:</div>
            <div class="flex w-[70px] h-[70px] py-[15px] flex-col items-center gap-[9px]" style="background-image: url('/Stamp.svg'); background-size: cover; background-repeat: no-repeat; background-position: center;">
              <p class="text-[10px] leading-[10px] font-bold text-red-500 font-inter text-center">WAWAN
            </p>
            <p class="text-[10px] leading-[10px] font-normal text-red-500 font-inter text-center">
            05.05.2025
            </p>
            </div>
            <div class="text-[12px] font-bold italic">(WAWAN WIJAYA)</div>
          </div>
        </div>
        <div class="flex flex-col items-start gap-1 mb-6 text-[10px] font-bold">
          <div class="mb-[50px]">CONFIRMATION RECEIVED BY SUPPLIER</div>
          <div>(NAME / SIGN / COMPANY STAMP)</div>
        </div>
      </div>
    </div>

   
    <!-- Combined Preview Output -->
        <div id="result" class="mt-6 flex justify-center hidden">

        <div style="width: 21cm; min-height: 29.7cm; padding: 2cm; font-size: 10pt;" class="bg-white border shadow text-[10pt]"></div>
      </div>

      <div id="previewModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded shadow-xl overflow-y-auto max-h-[90vh] w-[90vw] relative">
          <button
            onclick="closeModal()"
            class="absolute top-2 right-2 bg-red-500 text-white rounded-full px-3 py-1 text-xs hover:bg-red-600"
          >
            Close
          </button>
          <div id="modalContent" class="text-[10pt]"></div>
        </div>
      </div>
      

    <!-- TinyMCE Setup + Script -->
    <script>
      tinymce.init({
        selector: "#project-field",
        height: 300,
        base_url: "/node_modules/tinymce",
        plugins: "table code lists",
        toolbar:
          "undo redo | styles | bold italic | table | alignleft aligncenter alignright | bullist numlist  | code",
        menubar: false,
      });

      function generateFullDoc() {
  const modal = document.getElementById("previewModal");
  const modalContent = document.getElementById("modalContent");

  const letterhead = document.getElementById("letterhead").outerHTML;
  const approval = document.getElementById("approval").outerHTML;
  const projectContent = tinymce.get("project-field").getContent();

  const attn = document.getElementById("attn").value;
  const ref = document.getElementById("ref").value;
  const project = document.getElementById("project").value;
  const date = document.getElementById("date")?.innerText ?? "";
  const total = document.getElementById("total").value;
  const payment = document.getElementById("payment").value;
  const startDate = document.getElementById("startDate").value;
  const endDate = document.getElementById("endDate").value;
  const budgetNo = document.getElementById("budgetNo").value;
  const remark = document.getElementById("remark").value;
  const vendor = document.getElementById("vendor")?.innerText ?? "##VENDOR##";

  const letterbody = `
    <table class="table-auto w-full text-[10px]">
      <tbody>
        <tr><td class="w-[170px] align-top">To</td><td>: ${vendor}</td></tr>
        <tr><td class="align-top">Attn</td><td>: ${attn}</td></tr>
        <tr><td class="align-top">Ref Quotation No & Date</td><td>: ${ref}</td></tr>
        <tr><td class="align-top">Project</td><td>: ${project}<br>${projectContent}</td></tr>
        <tr><td class="align-top">Date</td><td>: ${date}</td></tr>
        <tr><td class="align-top">Total</td><td>: ${total}</td></tr>
        <tr><td class="align-top">Payment Term</td><td>: ${payment}</td></tr>
        <tr><td class="align-top">Start Date</td><td>: ${startDate}</td></tr>
        <tr><td class="align-top">End Date</td><td>: ${endDate}</td></tr>
        <tr><td class="align-top">BUDGET NO</td><td>: ${budgetNo}</td></tr>
        <tr><td class="align-top">Remark</td><td>: ${remark}</td></tr>
      </tbody>
    </table>
    <p class="text-[10px] mt-2">Please attach working order confirmation together with Invoice.</p>
  `;

  const fullDoc = `
    <div style="width: 21cm; min-height: 29.7cm; padding: 2cm; font-size: 10pt;" class="bg-white border shadow mx-auto">
      ${letterhead}
      <div class="mt-6">${letterbody}</div>
      <div class="mt-6">${approval}</div>
    </div>
  `;

  modalContent.innerHTML = fullDoc;
  modal.classList.remove("hidden");
}
// Fungsi untuk menutup modal
function closeModal() {
  document.getElementById("previewModal").classList.add("hidden");
}

// Event listener untuk klik di luar konten modal
document.addEventListener("click", function (e) {
  const modal = document.getElementById("previewModal");
  const modalContent = document.getElementById("modalContent");
  if (!modal.classList.contains("hidden") && modal.contains(e.target) && !modalContent.contains(e.target)) {
    closeModal();
  }
});

document.addEventListener('DOMContentLoaded', function () {
  // Function to initialize the Air Datepicker
  function datepicker(selector) {
    new AirDatepicker(selector, {
      dateFormat: 'dd-MM-yyyy',
      minDate: new Date(),
      locale: {
        days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
        daysMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
        months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
        today: "Today",
        clear: "Clear",
        firstDay: 0
      },
    });
  }

  // Initialize datepickers for both startDate and endDate
  datepicker("#startDate");
  datepicker("#endDate");
});


    </script>
  </body>
</html>
